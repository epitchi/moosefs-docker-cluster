services:
  mfsmaster:
    build: ./moosefs-master
    container_name: "mfsmaster"
    networks:
      moosefsnet:
        ipv4_address: "172.20.0.2"
    ports:
      - "9419:9419"
      - "9420:9420"
      - "9421:9421"
    volumes:
            - ./data/master/meta:/var/lib/mfs
            # - ./data/master/meta/mfsexports.cfg:/etc/mfs/mfsexports.cfg:ro
    hostname: mfsmaster
    environment:
      - MFS_ENV=PROD 
      # In the TEST environment, if metadata.mfs file or other metadata files
      # like metdata.mfs.back and changelog.0.mfs are missing, the script will
      # create an EMPTY metadata file!
      # When MFS_ENV=PROD metdata.mfs file will not be created!

  mfscgi:
    build: ./moosefs-cgi
    container_name: "mfscgi"
    networks:
      moosefsnet:
        ipv4_address: "172.20.0.3"
    ports:
      - "9425:9425"
    depends_on:
      - mfsmaster

  mfsmetalogger:
    build: ./moosefs-metalogger
    container_name: "mfsmetalogger"
    networks:
      moosefsnet:
        ipv4_address: "172.20.0.4"
    volumes:
      - ./data/metalogger/meta:/var/lib/mfs
    environment:
      - MFS_ENV=PROD
      # In the TEST environment, if metadata.mfs file or other metadata files
      # like metdata.mfs.back and changelog.0.mfs are missing, the script will
      # create an EMPTY metadata file!
      # When MFS_ENV=PROD metdata.mfs file will not be created!
    depends_on:
      - mfsmaster
  # fsmaster
  # mfsclient2:
  #   build: ./moosefs-client
  #   container_name: "mfsclient2"
  #   cap_add:
  #     - SYS_ADMIN
  #   devices:
  #     - /dev/fuse:/dev/fuse
  #   security_opt:
  #     - apparmor:unconfined
  #   stdin_open: true
  #   tty: true
  #   links:
  #     - mfsmaster
  #   networks:
  #     moosefsnet:
  #       ipv4_address: "172.20.0.102"
  #   depends_on:
  #     - mfsmaster
  #   volumes:
  #     - /user_data:/mnt/moosefs:shared

networks:
  moosefsnet:
    driver: bridge
    ipam:
     config:
       - subnet: 172.20.0.0/16
